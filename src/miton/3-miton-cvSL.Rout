
R version 3.2.4 (2016-03-10) -- "Very Secure Dishes"
Copyright (C) 2016 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin13.4.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> 
> #-------------------------------
> # 3-miton-cvSL.R
> #
> # Compute the cross-validated
> # risk for the super leaner
> # and its constituent algorithms
> #
> # in the Miton Haiti survey
> # (low transmission P. falciparum MSP-1)
> #-------------------------------
> 
> #-------------------------------
> # preamble
> #-------------------------------
> rm(list=ls())
> library(SuperLearner)
Loading required package: nnls
Super Learner
Version: 2.0-15
Package created on 2014-07-16

Use SuperLearnerNews() to see changes from previous versions and latest news

> library(tmleAb)
Welcome to the tmleAb package
Targeted maximum likelihood estimation for antibody (Ab) measurements.
> library(r2weight)
> library(RColorBrewer)
> 
> #-------------------------------
> # load data
> #-------------------------------
> # d <- read.csv("~/dropbox/articles/antibody-curves/data/miton/haiti2-malaria-miton-public.csv")
> d <- miton_malaria
> 
> # for 6 negative MSP_1 values, replace as 0
> d$msp1 <- d$msp13d7
> d$msp1[d$msp1<0] <- 0
> 
> 
> #-------------------------------
> # fit cross-validated SL
> # with age as the only feature
> #-------------------------------
> SL.library <- c("SL.mean","SL.glm","SL.Yman2016","SL.gam","SL.loess","SL.randomForest","SL.polymars","SL.svm","SL.nnet")
> 
> set.seed(32423)
> CVmiton <- ab_cvSL(Y=log10(d$msp1+1),Age=d$age,family=gaussian(),V=10,SL.library=SL.library)
Loading required package: randomForest
randomForest 4.6-10
Type rfNews() to see new features/changes/bug fixes.
Loading required package: gam
Loading required package: splines
Loading required package: foreach
Loaded gam 1.12

Loading required package: nnet
Loading required package: polspline
Loading required package: e1071
> 
> summary(CVmiton)

Call:  
SuperLearner::CV.SuperLearner(Y = fitd$Y, X = X, V = V, family = family,  
    SL.library = SL.library, id = fitd$id, control = list(saveFitLibrary = TRUE)) 


Risk is based on: Mean Squared Error

All risk estimates are based on V =  10 

                Algorithm    Ave       se     Min    Max
            Super Learner 1.2110 0.073253 0.94889 1.5667
              Discrete SL 1.2498 0.092156 0.96276 1.5899
              SL.mean_All 1.5349 0.072614 1.25478 1.8318
               SL.glm_All 1.3140 0.070794 1.13697 1.7256
          SL.Yman2016_All 1.3402 0.093508 0.95715 1.5720
           SL.gam.df5_All 1.1764 0.069921 0.96276 1.5363
             SL.loess_All 1.1793 0.070169 0.97290 1.5623
 SL.randomForest.ns40_All 1.2062 0.075868 0.96831 1.6558
          SL.polymars_All 1.2227 0.076420 0.90536 1.6204
               SL.svm_All 1.2003 0.068869 0.96687 1.5482
              SL.nnet_All 1.2363 0.093638 0.96212 1.6755
> 
> 
> #-------------------------------
> # plot the CV MSE estimates
> #-------------------------------
> cbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
> cols <- cbPalette[c(1:4,6:8)]
> cols <- c(cols,brewer.pal(8,"Dark2")[1:3])
> 
> pdf("~/dropbox/articles/antibody-curves/results/figs/miton-cvSL.pdf")
> ab_plot_cvSL(CVmiton,col=cols,ylab="10-fold Cross-validated MSE Estimate",title="P. falciparum, low transmission (age only)")
Loading required package: ggplot2
> dev.off()
null device 
          1 
> 
> #-------------------------------
> # convert CV MSE into R2
> # using the r2weight package
> # and plot the R2 estimates
> #-------------------------------
> pdf("~/dropbox/articles/antibody-curves/results/figs/miton-cvR2.pdf")
> ab_plot_cvR2(CVmiton,data.frame(Age=d$age),col=cols,ylab="10-fold Cross-validated R-squared",title="P. falciparum, (Miton, Haiti)",ylim=c(0,0.6))
   cvr2$Algorithm     r2  lower  upper
1   Super Learner 0.2110 0.1336 0.2815
2     Simple Mean 0.0000 0.0000 0.0000
3             GLM 0.1439 0.0864 0.1979
4        Yman2016 0.1268 0.0380 0.2074
5             GAM 0.2335 0.1532 0.3063
6           LOESS 0.2317 0.1509 0.3047
7   Random Forest 0.2141 0.1242 0.2949
8            MARS 0.2034 0.1224 0.2769
9             SVM 0.2180 0.1434 0.2861
10     Neural Net 0.1945 0.1167 0.2655
> dev.off()
null device 
          1 
> 
> 
> #-------------------------------
> # save down the results
> #-------------------------------
> save(CVmiton,file="~/dropbox/articles/antibody-curves/results/raw/miton-cvSL.RData")
> 
> 
> 
> 
> proc.time()
   user  system elapsed 
 31.601   0.378  32.571 
