
R version 3.2.4 (2016-03-10) -- "Very Secure Dishes"
Copyright (C) 2016 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin13.4.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> 
> #-------------------------------
> # 5-mauke-cvSL.R
> #
> # Compute the cross-validated
> # risk for the super leaner
> # and its constituent algorithms
> #
> # in the Mauke 1992 survey
> #-------------------------------
> 
> #-------------------------------
> # preamble
> #-------------------------------
> rm(list=ls())
> library(SuperLearner)
Loading required package: nnls
Super Learner
Version: 2.0-15
Package created on 2014-07-16

Use SuperLearnerNews() to see changes from previous versions and latest news

> library(tmleAb)
Welcome to the tmleAb package
Targeted maximum likelihood estimation for antibody (Ab) measurements.
> library(r2weight)
> library(RColorBrewer)
> 
> #-------------------------------
> # load data
> #-------------------------------
> d <- read.csv("~/dropbox/articles/antibody-curves/data/mauke/mauke1992-public.csv")
> 
> # add 0.5 years to age to remove bias (on average) due to rounding to year
> d$age <- d$age+0.5
> 
> 
> #-------------------------------
> # fit cross-validated SL
> # with age as the only feature
> #-------------------------------
> SL.library <- c("SL.mean","SL.glm","SL.Yman2016","SL.gam","SL.loess","SL.randomForest","SL.polymars","SL.svm","SL.nnet")
> 
> set.seed(32423)
> CVmauke <- ab_cvSL(Y=log10(d$wb123),Age=d$age,family=gaussian(),V=10,SL.library=SL.library)
Loading required package: randomForest
randomForest 4.6-10
Type rfNews() to see new features/changes/bug fixes.
Loading required package: gam
Loading required package: splines
Loading required package: foreach
Loaded gam 1.12

Loading required package: nnet
Loading required package: polspline
Loading required package: e1071
> 
> summary(CVmauke)

Call:  
SuperLearner::CV.SuperLearner(Y = fitd$Y, X = X, V = V, family = family,  
    SL.library = SL.library, id = fitd$id, control = list(saveFitLibrary = TRUE)) 


Risk is based on: Mean Squared Error

All risk estimates are based on V =  10 

                Algorithm     Ave       se     Min    Max
            Super Learner 0.89220 0.072173 0.55073 1.5366
              Discrete SL 0.89490 0.071929 0.52916 1.5183
              SL.mean_All 1.06915 0.082034 0.73474 1.9644
               SL.glm_All 0.93346 0.073021 0.63072 1.6773
          SL.Yman2016_All 0.90084 0.073417 0.52223 1.5084
           SL.gam.df6_All 0.89830 0.072645 0.52916 1.5183
             SL.loess_All 0.90086 0.072617 0.52845 1.5130
 SL.randomForest.ns35_All 0.94316 0.079495 0.58639 1.6392
          SL.polymars_All 0.89531 0.071423 0.54041 1.4975
               SL.svm_All 0.89947 0.072740 0.52780 1.4949
              SL.nnet_All 0.99910 0.081485 0.60692 1.9644
> 
> 
> #-------------------------------
> # plot the CV MSE estimates
> #-------------------------------
> cbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
> cols <- cbPalette[c(1:4,6:8)]
> cols <- c(cols,brewer.pal(8,"Dark2")[1:3])
> 
> pdf("~/dropbox/articles/antibody-curves/results/figs/mauke-cvSL.pdf")
> ab_plot_cvSL(CVmauke,col=cols,ylab="10-fold Cross-validated MSE Estimate",title="W. bancrofti, Mauke 1992")
Loading required package: ggplot2
> dev.off()
null device 
          1 
> 
> #-------------------------------
> # convert CV MSE into R2
> # using the r2weight package
> # and plot the R2 estimates
> #-------------------------------
> pdf("~/dropbox/articles/antibody-curves/results/figs/mauke-cvR2.pdf")
> ab_plot_cvR2(CVmauke,data.frame(Age=d$age),col=cols,ylab="10-fold Cross-validated R-squared",title="W. bancrofti, Mauke 1992",ylim=c(0,0.6))
   cvr2$Algorithm     r2   lower  upper
1   Super Learner 0.1655  0.0910 0.2339
2     Simple Mean 0.0000  0.0000 0.0000
3             GLM 0.1269  0.0698 0.1805
4        Yman2016 0.1574  0.0705 0.2362
5             GAM 0.1598  0.0852 0.2283
6           LOESS 0.1574  0.0791 0.2291
7   Random Forest 0.1178  0.0312 0.1967
8            MARS 0.1626  0.0897 0.2296
9             SVM 0.1587  0.0874 0.2245
10     Neural Net 0.0655 -0.0190 0.1430
> dev.off()
null device 
          1 
> 
> 
> #-------------------------------
> # save down the results
> #-------------------------------
> save(CVmauke,file="~/dropbox/articles/antibody-curves/results/raw/mauke-cvSL.RData")
> 
> 
> 
> 
> proc.time()
   user  system elapsed 
 58.699   1.312  81.444 
